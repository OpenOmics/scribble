###This line is used to filter out cells with outlier features (nCount_RNA, nFeature_RNA and percent mitochondria) in a list of seurat objects using
median absolute deviation (MAD).

for (i in 1:length(sgcList)) { ##sgcList is a list of multiple seurat object SC data
  print(paste0("Sample ",i))
  sgc.sample <- sgcList[[i]]
  low_lib_size <- isOutlier(sgc.sample$nCount_RNA, log=TRUE, type="lower")
  high_lib_size <- isOutlier(sgc.sample$nCount_RNA, log=TRUE, type="higher")
  low_nfeature <- isOutlier(sgc.sample$nFeature_RNA, log=TRUE, type="lower")
  high_nfeature <- isOutlier(sgc.sample$nFeature_RNA, log=TRUE, type="higher")
  high_mit <- isOutlier(sgc.sample$percent.mt, log=TRUE, type="higher")
  sgc.sample <- sgc.sample %>% mutate(low_lib_size = low_lib_size, high_lib_size = high_lib_size,
                                      low_nfeature = low_nfeature, high_nfeature = high_nfeature,
                                      high_mit = high_mit)
  #Filtering out the outliers
  sgc.sample<- subset(sgc.sample, low_lib_size == "FALSE" & high_lib_size =="FALSE" &
                        low_nfeature == "FALSE" & high_nfeature == "FALSE" &
                        high_mit == "FALSE")
  sgcList[[i]] <- sgc.sample
}
